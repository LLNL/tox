<!-- ======================================================================= -->
<project name="tox" default="main" basedir="./">
	<!-- =================================================================== -->
	<!-- get enviroment from OS -->
	<!-- =================================================================== -->
	<property environment="env"/> 
	<!-- =================================================================== -->
	<!-- set misc properties -->
	<!-- =================================================================== -->
	<buildnumber file="build.number"/>
	<property name="name" value="tox"/> 
	<property name="version" value="1.6.1"/>
	<property name="JDK" value="1.5"/>
	<!-- =================================================================== -->
	<!-- clean everything -->
	<!-- =================================================================== -->
	<target name="clean" description="remove clutter">
		<echo message="clean --------------------------------------"/>
		<delete dir="tmp"/>
		<delete dir="deploy"/>
		<delete>
			<fileset dir="./" includes="src/*.sql.err"/>
			<fileset dir="./" includes="*.out"/>
			<fileset dir="./" includes="*.err"/>
		</delete>
		<echo message="clean --------------------------------------"/>
	</target>
	<!-- =================================================================== -->
	<!-- compile java -->
	<!-- =================================================================== -->
	<target name="compile.java" description="compile java">
		<echo message="compile.java ---------------------------"/>
		<path id="classpath">
			<pathelement location="lib/saxon9.jar"/>
			<pathelement location="lib/servlet.jar"/>
			<pathelement location="lib/commons-httpclient-3.1.jar"/>
			<pathelement location="lib/orai18n.jar"/>
			<pathelement location="lib/ojdbc14.jar"/>
		</path>
		<mkdir dir="tmp/classes"/>
		<javac source="${JDK}" target="${JDK}" srcdir="src" destdir="tmp/classes" debug="on" deprecation="on" optimize="on">
			<classpath refid="classpath"/>
			<compilerarg value="-Xlint"/>
		</javac>
		<manifest file="tmp/MANIFEST.MF">
			<attribute name="Built-By" value="David Craig Cothren"/>
			<attribute name="Implementation-Version" value="${version} build ${build.number}"/>
		</manifest>
		<jar jarfile="tmp/tox.jar" basedir="tmp/classes" manifest="tmp/MANIFEST.MF"/>
		<echo message="compile.java ---------------------------"/>
	</target>
	<!-- =================================================================== -->
	<!-- load war -->
	<!-- =================================================================== -->
	<target name="load.war" depends="clean, compile.java" description="move everything to the web archive">
		<echo message="load.war -----------------------------------"/>
		<mkdir dir="tmp/tox"/>
		<mkdir dir="tmp/tox/dtd"/>
		<copy todir="tmp/tox/META-INF">
			<fileset dir="src">
				<include name="context.xml"/>
			</fileset>
		</copy>
		<copy todir="tmp/tox/WEB-INF/lib">
			<fileset dir="lib">
				<include name="saxon9.jar"/>
				<include name="orai18n.jar"/>
				<include name="commons-logging-1.1.1.jar"/>
				<include name="commons-httpclient-3.1.jar"/>
			</fileset>
			<fileset dir="tmp">
				<include name="tox.jar"/>
			</fileset>
		</copy>
		<copy todir="tmp/tox/WEB-INF/classes">
			<fileset dir="src">
				<include name="logging.properties"/>
			</fileset>
		</copy>
		<copy todir="tmp/tox/dtd" flatten="yes">
			<fileset dir="src">
				<include name="*.dtd"/>
			</fileset>
		</copy>
		<war warfile="tox.war" webxml="src/web.xml" manifest="tmp/MANIFEST.MF">
			<fileset dir="tmp/tox"/>
		</war>
		<echo message="load.war -----------------------------------"/>
	</target>
	<!-- =================================================================== -->
	<!-- load test war -->
	<!-- =================================================================== -->
	<target name="load.test.war" description="move everything to the web archive">
		<echo message="load.test.war ------------------------------"/>
		<mkdir dir="tmp/test"/>
		<copy todir="tmp/test/WEB-INF/lib">
			<fileset dir="lib">
				<include name="commons-httpclient-3.1.jar"/>
				<include name="commons-codec-1.3.jar"/>
			</fileset>
			<fileset dir=".">
				<include name="tox.jar"/>
			</fileset>
		</copy>
		<copy todir="tmp/test/WEB-INF">
			<fileset dir="src">
				<include name="tox.tld"/>
			</fileset>
		</copy>
		<filter token="TEST_HOST" value="${test.host}"/>
		<filter token="TEST_PORT" value="${test.port}"/>
		<copy todir="tmp/test" flatten="yes" filtering="true">
			<fileset dir="src">
				<include name="*.js"/>
				<include name="*.jsp"/>
				<include name="*.xsl"/>
				<include name="*.html"/>
				<include name="*.xml"/>
				<include name="*.css"/>
				<exclude name="test-web.xml"/>
				<exclude name="context.xml"/>
				<exclude name="web.xml"/>
			</fileset>
		</copy>
		<war warfile="test.war" webxml="src/test-web.xml">
			<fileset dir="tmp/test"/>
		</war>
		<echo message="load.test.war ------------------------------"/>
	</target>
	<!-- =================================================================== -->
	<!-- default -->
	<!-- =================================================================== -->
	<target name="main" depends="load.war, load.test.war" description="default">
	</target>
	<!-- =================================================================== -->
</project>
<!-- ======================================================================= -->
